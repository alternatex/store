// Metawidget 3.6 minified (licensed under LGPL)
//
// This library is free software; you can redistribute it and/or
// modify it under the terms of the GNU Lesser General Public
// License as published by the Free Software Foundation; either
// version 2.1 of the License, or (at your option) any later version.
//
// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
// Lesser General Public License for more details.
//
// You should have received a copy of the GNU Lesser General Public
// License along with this library; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA

(function(){var b=["$compile","$parse",function(c,d){return{restrict:"E",scope:{ngModel:"=",readOnly:"=",config:"=",configs:"&"},transclude:true,compile:function e(h,g,f){return function(l,k,j){var n=new metawidget.angular.AngularMetawidget(k,j,f,l,c,d);var m=undefined;i();l.$watch("ngModel",function(p,o){if(p!==m&&typeof(p)==="object"){n.invalidateInspection();i()}});l.$watch("readOnly",function(p,o){if(p!==n.readOnly){i()}});l.$watch("config",function(p,o){if(p!==o){n.configure(p);i()}});function i(){m=l.$eval("ngModel");n.path=j.ngModel;n.toInspect=l.$parent.$eval(metawidget.util.splitPath(n.path).type);n.readOnly=l.$eval("readOnly");n.buildWidgets()}}}}}];var a=angular.module("metawidget",[]);a.directive("metawidget",b);a.directive("mwMetawidget",b);metawidget.angular=metawidget.angular||{};metawidget.angular.AngularMetawidget=function(g,d,c,h,f,i){if(!(this instanceof metawidget.angular.AngularMetawidget)){throw new Error("Constructor called as a function")}var e=new metawidget.Pipeline(g[0]);e._superLayoutWidget=e.layoutWidget;e.layoutWidget=function(n,k,m,l,o){e._superLayoutWidget.call(this,n,k,m,l,o);if(n.transcluded===undefined){f(n)(h.$parent)}};var j=undefined;this.invalidateInspection=function(){j=undefined};e.inspector=new metawidget.inspector.PropertyTypeInspector();e.inspectionResultProcessors=[new metawidget.angular.inspectionresultprocessor.AngularInspectionResultProcessor(h)];e.widgetBuilder=new metawidget.widgetbuilder.CompositeWidgetBuilder([new metawidget.widgetbuilder.OverriddenWidgetBuilder(),new metawidget.widgetbuilder.ReadOnlyWidgetBuilder(),new metawidget.widgetbuilder.HtmlWidgetBuilder()]);e.widgetProcessors=[new metawidget.widgetprocessor.IdProcessor(),new metawidget.widgetprocessor.PlaceholderAttributeProcessor(),new metawidget.angular.widgetprocessor.AngularWidgetProcessor(i,h)];e.layout=new metawidget.layout.HeadingTagLayoutDecorator(new metawidget.layout.TableLayout());this.configure=function(k){e.configure(k);this.invalidateInspection()
};this.configure(h.$eval("config"));this.configure(h.configs());this.inspect=function(m,k,l){return e.inspect(m,k,l,this)};this.buildWidgets=function(o){var k=c(h.$parent,function(p){return p});this.overriddenNodes=[];for(var l=0;l<k.length;l++){var n=k[l];if(n.nodeType===1&&(n.tagName!=="SPAN"||n.attributes.length>1)){n.transcluded=true;this.overriddenNodes.push(n)}}if(o!==undefined){j=o}else{if(j===undefined){if(arguments.length>0){throw new Error("Calling buildWidgets( undefined ) may cause infinite loop. Check your argument, or pass no arguments instead")}var m=metawidget.util.splitPath(this.path);j=e.inspect(this.toInspect,m.type,m.names,this)}}e.buildWidgets(j,this)};this.onEndBuild=function(){while(this.overriddenNodes.length>0){var l=this.overriddenNodes[0];this.overriddenNodes.splice(0,1);if(l.tagName==="FACET"){continue}var o=undefined;for(var q=0,m=l.attributes.length;q<m;q++){var n=l.attributes[q];var p=d.$normalize(n.name).toLowerCase();if(p==="ngbind"||p==="ngmodel"){var r=metawidget.util.splitPath(n.value);var s=h.$parent.$eval(r.type);o=e.inspect(s,r.type,r.names,this);break}}if(o===undefined){o={section:""}}if(l.tagName==="STUB"){for(var q=0,m=l.attributes.length;q<m;q++){var k=l.attributes[q];o[k.nodeName]=k.nodeValue}}e.layoutWidget(l,"property",o,e.element,this)}};this.getElement=function(){return e.element};this.buildNestedMetawidget=function(k,l){var m=metawidget.util.createElement(this,"metawidget");m.setAttribute("ng-model",d.ngModel+"."+k.name);if(metawidget.util.isTrueOrTrueString(k.readOnly)){m.setAttribute("read-only","true")}else{if(d.readOnly!==undefined){m.setAttribute("read-only",d.readOnly)}}h.$parent._metawidgetConfig=e;if(l!==undefined){h.$parent._metawidgetConfig2=l;m.setAttribute("configs","[_metawidgetConfig,_metawidgetConfig2]")}else{m.setAttribute("configs","_metawidgetConfig")}return m}};metawidget.angular.inspectionresultprocessor=metawidget.angular.inspectionresultprocessor||{};metawidget.angular.inspectionresultprocessor.AngularInspectionResultProcessor=function(c){if(!(this instanceof metawidget.angular.inspectionresultprocessor.AngularInspectionResultProcessor)){throw new Error("Constructor called as a function")
}this.processInspectionResult=function(e,g){for(var d in e){var f=e[d];if(f instanceof Object){this.processInspectionResult(f,g);continue}if(f===undefined||f.slice===undefined){continue}if(f.length<4||f.slice(0,2)!=="{{"||f.slice(f.length-2,f.length)!=="}}"){continue}f=f.slice(2,f.length-2);e[d]=c.$parent.$eval(f)+"";c.$parent.$watch(f,function(i,h){if(i!==h){g.invalidateInspection();g.buildWidgets()}})}return e}};metawidget.angular.widgetprocessor=metawidget.angular.widgetprocessor||{};metawidget.angular.widgetprocessor.AngularWidgetProcessor=function(e,d){if(!(this instanceof metawidget.angular.widgetprocessor.AngularWidgetProcessor)){throw new Error("Constructor called as a function")}this.processWidget=function(j,o,i,n){var l=n.path;if(o!=="entity"){l+="."+i.name}if(j.tagName==="OUTPUT"){if(i.masked===true){d.$parent._mwMaskedOutput=c;j.setAttribute("ng-bind","_mwMaskedOutput("+l+")")}else{if(i.type==="array"){j.setAttribute("ng-bind",l+".join(', ')")}else{if(i.enumTitles!==undefined){d.$parent._mwLookupEnumTitle=d.$parent._mwLookupEnumTitle||{};d.$parent._mwLookupEnumTitle[l]=function(p){return metawidget.util.lookupEnumTitle(p,i["enum"],i.enumTitles)};j.setAttribute("ng-bind",'_mwLookupEnumTitle["'+l+'"]('+l+")")}else{j.setAttribute("ng-bind",l)}}}}else{if(j.tagName==="BUTTON"){j.setAttribute("ng-click",l+"()")}else{if(i["enum"]!==undefined&&(i.type==="array"||i.componentType!==undefined)&&j.tagName==="DIV"){for(var k=0,h=j.childNodes.length;k<h;k++){var m=j.childNodes[k];if(m.tagName==="LABEL"&&m.childNodes.length===2){var g=m.childNodes[0];if(g.tagName==="INPUT"){if(g.getAttribute("type")==="radio"){g.setAttribute("ng-model",l)}else{if(g.getAttribute("type")==="checkbox"){g.setAttribute("ng-checked",l+".indexOf('"+g.value+"')>=0");d.$parent._mwUpdateSelection=f;g.setAttribute("ng-click","_mwUpdateSelection($event,'"+l+"')")}}}}}}else{j.setAttribute("ng-model",l)}}}if(i.required!==undefined){j.setAttribute("ng-required",i.required)}if(i.minLength!==undefined){j.setAttribute("ng-minlength",i.minLength)
}if(i.maxLength!==undefined){j.setAttribute("ng-maxlength",i.maxLength);j.removeAttribute("maxlength")}return j};function f(g,k){var i=d.$parent.$eval(k);if(i===undefined){i=[];e(k).assign(d.$parent,i)}var j=g.target;var h=i.indexOf(j.value);if(j.checked===true){if(h===-1){i.push(j.value)}return}if(h!==-1){i.splice(h,1)}}function c(g){if(g===undefined){return}return metawidget.util.fillString("*",g.length)}}})();
